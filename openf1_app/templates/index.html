<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>F1 Live Data</title>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.3.2/dist/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Arial;
        margin: 20px;
      }
      table,
      th,
      td {
        border: 1px solid #ccc;
        border-collapse: collapse;
        padding: 8px;
      }
      th {
        background-color: #eee;
      }
      select,
      button {
        padding: 5px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>F1 Live Data</h1>

    <h2>Drivers:</h2>
    <ul id="drivers-list"></ul>

    <h2>Positions:</h2>
    <table id="positions-table">
      <thead>
        <tr>
          <th>Driver Number</th>
          <th>Position</th>
          <th>Session Key</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Race Results:</h2>
    <label for="driver-select">Select Driver:</label>
    <select id="driver-select"></select>
    <button onclick="requestRaceResults()">Load Race Results</button>

    <table id="race-results-table">
      <thead>
        <tr>
          <th>Race</th>
          <th>Date</th>
          <th>Position</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const socket = io.connect('http://127.0.0.1:5000');

      window.onload = () => {
        socket.emit('request_positions');
      };

      socket.on('drivers_data', function (drivers) {
        displayDrivers(drivers);
        populateDriverSelect(drivers);
      });

      socket.on('positions_data', function (data) {
        displayPositions(data);
      });

      socket.on('race_results_data', function (results) {
        displayRaceResults(results);
      });

      function displayDrivers(drivers) {
        const list = document.getElementById('drivers-list');
        list.innerHTML = '';
        drivers.forEach((driver) => {
          const li = document.createElement('li');
          li.textContent = `${driver.full_name} (${driver.driver_number})`;
          list.appendChild(li);
        });
      }

      function populateDriverSelect(drivers) {
        const select = document.getElementById('driver-select');
        select.innerHTML = '';
        drivers.forEach((driver) => {
          const option = document.createElement('option');
          option.value = driver.driver_number;
          option.textContent = `${driver.full_name} (#${driver.driver_number})`;
          select.appendChild(option);
        });
      }

      function displayPositions(positions) {
        const table = document.querySelector('#positions-table tbody');
        table.innerHTML = '';
        positions.forEach((p) => {
          const row = document.createElement('tr');
          row.innerHTML = `
          <td>${p.driver_number}</td>
          <td>${p.position}</td>
          <td>${p.session_key}</td>
          <td>${p.date}</td>
        `;
          table.appendChild(row);
        });
      }

      function requestRaceResults() {
        const driverNumber = document.getElementById('driver-select').value;
        socket.emit('request_race_results', { driver_number: driverNumber });
      }

      function displayRaceResults(results) {
        const table = document.querySelector('#race-results-table tbody');
        table.innerHTML = '';
        results.forEach((r) => {
          const row = document.createElement('tr');
          row.innerHTML = `
          <td>${r.session_name}</td>
          <td>${new Date(r.date).toLocaleDateString()}</td>
          <td>${r.position ?? 'N/A'}</td>
          <td>${r.status}</td>
        `;
          table.appendChild(row);
        });
      }
    </script>
  </body>
</html>
